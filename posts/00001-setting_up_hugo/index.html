<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      TIL: Setting up Hugo to work with Github Pages &middot; Curious Koala
    
  </title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Clinging on to the pursuit of knowledge</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item " href="/post">Posts</a><a class="sidebar-nav-item" href="/about/" title="">About</a><a class="sidebar-nav-item" href="/categories/" title="Categories Section">Categories</a>
    </nav>

  <div class="sidebar-item">
    <p>&copy; 2020. All rights reserved.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Curious Koala</a>
            <small>Choon Kiat (CK)</small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">TIL: Setting up Hugo to work with Github Pages</h1>
  <span class="post-date">20 Apr 2020</span>
  <p>Unlike Jekyll, Hugo does not work with Github Pages out of the box.</p>
<p>The biggest worry for me was that I did not want the commit history of my site to be polluted with large changes to the generated files. Ideally, we want to separate the commit histories of the source files and the generated files.</p>
<p>One simple way of doing this is simply by creating 2 github repositories. One for the generated site and one for the source files used to generate the site. By adding the generated site repository as a submodule of the source file repository, both source and generated repositories will be committed together. This is the approach given in the <a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#step-by-step-instructions">Hugo Docs</a>.</p>
<p>However, just for fun, I wondered if one could still achieve the original requirement of source and generated file separation using only one github repo, which would make things much cleaner. This is complicated by the fact that for a Github User Page, the page can only be served out of the master branch.</p>
<p>We outline a simple solution below using different branches.</p>
<ol>
<li>Create a new repository and a new branch called source to store our source files. Note that we also need to ignore the <code>public/</code> folder, which is where all our generated files from Hugo will be stored.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Create the directory structure starting from an empty git repo</span>
git clone https://github.com/choonkiatlee/choonkiatlee.github.io.git

<span style="color:#75715e"># Create a new branch called source that will store our source files</span>
cd choonkiatlee.github.io
git checkout --orphan source

<span style="color:#75715e"># Setup the .gitignore file</span>
echo public/ &gt;&gt; .gitignore
</code></pre></div><ol start="2">
<li>Initialise our new Hugo site! (Based off the official <a href="https://gohugo.io/getting-started/quick-start/">Hugo documentation</a>)</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Initialise our hugo site</span>
hugo new site . --force

<span style="color:#75715e"># (Optional -- Add themes)</span>
git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke
echo <span style="color:#e6db74">&#39;theme = &#34;ananke&#34;&#39;</span> &gt;&gt; config.toml

<span style="color:#75715e"># (Optional -- Add some content)</span>
hugo new posts/my-first-post.md
</code></pre></div><ol start="3">
<li>Initialise our master branch within the public directory. All our generated files will live here, and can be pushed directly to our main branch on our Github Pages repository.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Setup the generated files git repo</span>
git clone https://github.com/choonkiatlee/choonkiatlee.github.io.git public

<span style="color:#75715e"># Generate the site for the first time</span>
hugo -D
</code></pre></div><ol start="4">
<li>Push all changes to the repository and watch the magic happen!</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Commit the source files</span>
git add .
git commit -m <span style="color:#e6db74">&#34;Initial commit of source files&#34;</span>
git push --set-upstream origin source

<span style="color:#75715e"># Commit the main site</span>
cd public
git add .
git commit -m <span style="color:#e6db74">&#34;Initial commit of generated site&#34;</span>
git push 
</code></pre></div><p>This results in a local directory setup that looks like this:</p>
<pre><code>.
├── archetypes (Source Files -- in the Source branch)
├── build.sh 
├── ...
└── public     (Generated Files -- in the Master branch)
    └── css
    └── tags
    └── ...
</code></pre><ol start="5">
<li>Lastly, you can build and push your entire site to github with the following script. The commands can also be run as-is on windows using the command prompt if you have git configured on your path.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Build your site</span>
hugo -D 

<span style="color:#75715e"># Commit and push</span>
cd  public 
git add .
git commit -m <span style="color:#e6db74">&#34;Update generated website&#34;</span>

<span style="color:#75715e"># Force push because we don&#39;t care about the state of our master branch, we just want to push our currently generated files</span>
git push -f
cd ..
</code></pre></div></div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
    
  </body>
</html>

